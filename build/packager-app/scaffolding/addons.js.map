{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./src/addons/gamepad/style.css","webpack:///./src/addons/gamepad/active.png","webpack:///./src/addons/gamepad/close.svg","webpack:///./src/addons/gamepad/cursor.png","webpack:///./src/addons/gamepad/dot.svg","webpack:///./src/addons/gamepad/gamepadlib.js","webpack:///./src/addons/gamepad/index.js","webpack:///./src/addons/gamepad/userscript.js","webpack:///./src/addons/index.js","webpack:///./src/addons/pause.js","webpack:///./src/addons/pointerlock.js","webpack:///./src/addons/special-cloud-behaviors.js","webpack:///./src/addons/unsafe-cloud-behaviors.js","webpack:///./src/common/event-target.js"],"names":["console","window","defaultAxesMappings","arrows","type","high","low","deadZone","wasd","cursor","sensitivity","emptyMapping","transformAndCopyMapping","mapping","warn","copy","Object","assign","button","prepareMappingForExport","prepareAxisMappingForExport","prepareButtonMappingForExport","padWithEmptyMappings","array","length","push","createEmptyMappingList","getMovementConfiguration","usedKeys","usesArrows","has","usesWASD","getGamepadId","gamepad","concat","id","index","GamepadData","constructor","gamepadLib","resetMappings","hints","getHints","buttonMappings","getDefaultButtonMappings","map","axesMappings","getDefaultAxisMappings","clearMappings","buttons","axes","importedSettings","alreadyUsedKeys","Set","add","possiblePauseKeys","possibleActionKeys","Array","from","filter","i","includes","findKey","keys","key","getPrimaryAction","getSecondaryAction","getPauseKey","getUp","getDown","getRight","getLeft","action1","action2","action3","action4","defaultHints","generated","GamepadLib","EventTarget","gamepads","Map","handleConnect","bind","handleDisconnect","update","animationFrame","currentTime","deltaTime","virtualCursor","x","y","maxX","Infinity","minX","maxY","minY","modified","_editor","connectCallbacks","keysPressedThisFrame","oldKeysPressed","mouseButtonsPressedThisFrame","oldMouseDown","addEventHandlers","addEventListener","removeEventHandlers","removeEventListener","gamepadConnected","size","Promise","resolve","getUserHints","resetControls","values","clearControls","e","callback","log","gamepadData","set","requestAnimationFrame","dispatchEvent","CustomEvent","detail","get","delete","cancelAnimationFrame","dispatchKey","pressed","dispatchMouse","down","dispatchMouseMove","updateButton","value","isDown","Math","abs","action","multiplier","speed","time","oldMouseButtonsPressed","max","min","navigator","getGamepads","data","axis","browserHasBrokenGamepadAPI","userAgent","setConsole","n","addStylesheet","css","stylesheet","document","createElement","textContent","head","appendChild","run","_ref","scaffolding","options","gamepadUserscript","pointerlock","gamepadUserstyle","_twGetAsset","path","_twAsset0","_twAsset1","_twAsset2","_twAsset3","Error","vm","editingTarget","runtime","once","vmStarted","_steppingInterval","scratchKeyToKey","toLowerCase","charAt","getKeysUsedByProject","allBlocks","getTargetForStage","targets","isOriginal","blocks","result","block","_blocks","opcode","parent","fields","KEY_OPTION","GAMEPAD_CONFIG_MAGIC","findOptionsComment","target","comments","comment","text","parseOptionsComment","lineWithMagic","split","find","endsWith","jsonText","substr","parsed","JSON","parse","isArray","parsedOptions","renderer","width","_xRight","_xLeft","height","_yTop","_yBottom","canvas","virtualCursorElement","hidden","className","src","hideCursorTimeout","hideRealCursor","body","classList","showRealCursor","remove","virtualCursorSetVisible","visible","clearTimeout","setTimeout","virtualCursorHide","virtualCursorSetDown","toggle","virtualCursorSetPosition","CURSOR_SIZE","stageX","stageY","style","transform","getCanvasSize","ResizeObserver","canvasWidth","canvasHeight","resizeObserver","entries","entry","contentRect","observe","rect","getBoundingClientRect","virtualX","virtualY","postMouseData","rectWidth","rectHeight","postIOData","_objectSpread","postKeyboardData","handleGamepadButtonDown","handleGamepadButtonUp","handleGamepadMouseDown","handleGamepadMouseUp","handleGamepadMouseMove","deltaX","deltaY","SPEED_MULTIPLIER","zoomMultiplierX","layersRect","stageWidth","zoomMultiplierY","stageHeight","pointerLockMove","_overlays","api","specialCloudBehaviors","unsafeCloudBehaviors","pause","ScaffoldingAddons","STATUS_PROMISE_WAIT","STATUS_DONE","paused","pausedThreadState","WeakMap","audioContextStateChange","setPaused","_paused","then","audioEngine","audioContext","suspend","ioDevices","clock","thread","threads","updateMonitor","pauseState","pauseTime","currentMSecs","status","emit","resume","now","Date","stackFrame","peekStackFrame","executionContext","timer","dt","startTime","ensurePausedThreadIsStillPaused","originalStepThreads","sequencer","stepThreads","call","originalGreenFlag","greenFlag","originalStartHats","startHats","_len","arguments","args","_key","apply","originalGetMonitorThreadCount","_getMonitorThreadCount","count","isPaused","_canvas","mouse","isLocked","movementX","movementY","_clientX","_clientY","_scratchX","_scratchY","contains","stopPropagation","requestPointerLock","pointerLockElement","error","oldStep","_step","ret","SAFE_PROTOCOLS","isSafeURL","url","u","URL","location","href","protocol","shouldAlwaysOpenInNewTab","shouldAlwaysOpenInCurrentTab","openInNewTab","open","openInCurrentTab","SpecialCloudBehaviorsProvider","enable","manager","setVariable","clipboardData","getData","webSocketProvider","providers","setProjectId","initialProjectId","projectId","handleUpdateVariable","name","setUsername","clipboard","writeText","newId","provider","addCloudProvider","addCloudProviderOverride","isPromise","v","jsValueToScratchValue","UnsafeCloudBehaviorsProvider","setEvalValue","setEvalError","evaluateAsync","js","eval","catch","EventTargetShim","_events","event","handler","handlers","fn","CustomEventShim"],"mappings":"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","file":"scaffolding/addons.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = \"./src/addons/index.js\");\n","module.exports = \".sa-gamepad-container {\\n  margin-right: 0.2rem;\\n}\\n\\n.sa-gamepad-spacer {\\n  display: flex;\\n  width: 100%;\\n  justify-content: flex-end;\\n}\\n\\n.sa-gamepad-popup-outer {\\n  /* above fullscreen */\\n  z-index: 99999;\\n}\\n.sa-gamepad-popup {\\n  box-sizing: border-box;\\n  width: 700px;\\n  max-height: min(800px, 85vh);\\n  height: 100%;\\n  max-width: 85%;\\n  margin: 50px auto;\\n  display: flex;\\n  flex-direction: column;\\n}\\n.sa-gamepad-popup-content {\\n  background-color: white;\\n  padding: 1.5rem 2.25rem;\\n  height: 100%;\\n  overflow-y: auto;\\n}\\n\\n.sa-gamepad-popup [class*=\\\"modal_header-item-title\\\"] {\\n  margin: 0 -20rem 0 0;\\n}\\n\\n.sa-gamepad-cursor {\\n  position: absolute;\\n  top: 0;\\n  left: 0;\\n  z-index: 9999;\\n  user-select: none;\\n  pointer-events: none;\\n  will-change: transform;\\n  image-rendering: optimizeSpeed;\\n  image-rendering: crisp-edges;\\n  image-rendering: pixelated;\\n}\\n.sa-gamepad-cursor-down {\\n  filter: invert(100%);\\n}\\n\\n.sa-gamepad-small .sa-gamepad-container[data-editor-mode=\\\"editor\\\"] {\\n  display: none !important;\\n}\\n\\n.sa-gamepad-hide-cursor {\\n  cursor: none;\\n}\\n\\n.sa-gamepad-browser-support-warning {\\n  font-weight: bold;\\n  margin-bottom: 10px;\\n}\\n\\n.sa-gamepad-store-settings {\\n  display: none;\\n}\\n.sa-gamepad-store-settings > input {\\n  margin-right: 4px;\\n}\\n.sa-gamepad-has-controller .sa-gamepad-store-settings {\\n  display: block;\\n}\\n\"","export default \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAYAAAAGCAIAAABvrngfAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsIAAA7CARUoSoAAAAAgSURBVBhXY/z//z8DKmCC0kgAKsQIBhA2FlXEmMXAAAC+2gYLeDM0CAAAAABJRU5ErkJggg==\"","export default \"data:image/svg+xml;base64,PHN2ZyBkYXRhLW5hbWU9IkxheWVyIDEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgdmlld0JveD0iMCAwIDcuNDggNy40OCI+PHBhdGggZD0iTTMuNzQgNi40OFYxTTEgMy43NGg1LjQ4IiBzdHlsZT0iZmlsbDpub25lO3N0cm9rZTojZmZmO3N0cm9rZS1saW5lY2FwOnJvdW5kO3N0cm9rZS1saW5lam9pbjpyb3VuZDtzdHJva2Utd2lkdGg6MnB4Ii8+PC9zdmc+Cg==\"","export default \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAYAAAAGCAIAAABvrngfAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsIAAA7CARUoSoAAAAAVSURBVBhXYyAF/AcDCJsJQpEKGBgAjmQF/WBrfi0AAAAASUVORK5CYII=\"","export default \"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI4IiBoZWlnaHQ9IjgiIHZpZXdCb3g9IjAgMCAyLjExNyAyLjExNyI+PGNpcmNsZSBjeD0iMS4wNTgiIGN5PSIxLjA1OCIgcj0iMS4wNTgiIGZpbGw9InJlZCIvPjwvc3ZnPgo=\"","import {EventTarget, CustomEvent} from '../../common/event-target';\n\nlet console = window.console;\n\n/*\nMapping types:\n\ntype: \"key\" maps a button to a keyboard key\nAll key names will be interpreted as a KeyboardEvent.key value (https://developer.mozilla.org/en-US/docs/Web/API/KeyboardEvent/key/Key_Values)\nhigh: \"KeyName\" is the name of the key to dispatch when a button reads a HIGH value\nlow: \"KeyName\" is the name of the key to dispatch when a button reads a LOW value\ndeadZone: 0.5 controls the minimum value necessary to be read in either + or - to trigger either high or low\nThe high/low distinction is necessary for axes. Buttons will only use high\n\ntype: \"mousedown\" maps a button to control whether the mouse is down or not\ndeadZone: 0.5 controls the minimum value to trigger a mousedown\nbutton: 0, 1, 2, etc. controls which button to press\n\ntype: \"virtual_cursor\" maps a button to control the \"virtual cursor\"\ndeadZone: 0.5 again controls the minimum value to trigger a movement\nsensitivity: 10 controls the speed\nhigh: \"+y\"/\"-y\"/\"+x\"/\"-x\" defines what happens when an axis reads high\nlow: \"+y\"/\"-y\"/\"+x\"/\"-x\" defines what happens when an axis reads low\n+y increases y, -y decreases y, +x increases x, -x decreases x.\n*/\n\nconst defaultAxesMappings = {\n  arrows: [\n    {\n      type: \"key\",\n      high: \"ArrowRight\",\n      low: \"ArrowLeft\",\n      deadZone: 0.5,\n    },\n    {\n      type: \"key\",\n      high: \"ArrowDown\",\n      low: \"ArrowUp\",\n      deadZone: 0.5,\n    },\n  ],\n  wasd: [\n    {\n      type: \"key\",\n      high: \"d\",\n      low: \"a\",\n      deadZone: 0.5,\n    },\n    {\n      type: \"key\",\n      high: \"s\",\n      low: \"w\",\n      deadZone: 0.5,\n    },\n  ],\n  cursor: [\n    {\n      type: \"virtual_cursor\",\n      high: \"+x\",\n      low: \"-x\",\n      sensitivity: 0.6,\n      deadZone: 0.2,\n    },\n    {\n      type: \"virtual_cursor\",\n      high: \"-y\",\n      low: \"+y\",\n      sensitivity: 0.6,\n      deadZone: 0.2,\n    },\n  ],\n};\n\nconst emptyMapping = () => ({\n  type: \"key\",\n  high: null,\n  low: null,\n});\nconst transformAndCopyMapping = (mapping) => {\n  if (typeof mapping !== \"object\" || !mapping) {\n    console.warn(\"invalid mapping\", mapping);\n    return emptyMapping();\n  }\n  const copy = Object.assign({}, mapping);\n  if (copy.type === \"key\") {\n    if (typeof copy.deadZone === \"undefined\") {\n      copy.deadZone = 0.5;\n    }\n    if (typeof copy.high === \"undefined\") {\n      copy.high = \"\";\n    }\n    if (typeof copy.low === \"undefined\") {\n      copy.low = \"\";\n    }\n  } else if (copy.type === \"mousedown\") {\n    if (typeof copy.deadZone === \"undefined\") {\n      copy.deadZone = 0.5;\n    }\n    if (typeof copy.button === \"undefined\") {\n      copy.button = 0;\n    }\n  } else if (copy.type === \"virtual_cursor\") {\n    if (typeof copy.high === \"undefined\") {\n      copy.high = \"\";\n    }\n    if (typeof copy.low === \"undefined\") {\n      copy.low = \"\";\n    }\n    if (typeof copy.sensitivity === \"undefined\") {\n      copy.sensitivity = 10;\n    }\n    if (typeof copy.deadZone === \"undefined\") {\n      copy.deadZone = 0.5;\n    }\n  } else {\n    console.warn(\"unknown mapping type\", copy.type);\n    return emptyMapping();\n  }\n  return copy;\n};\nconst prepareMappingForExport = (mapping) => Object.assign({}, mapping);\nconst prepareAxisMappingForExport = prepareMappingForExport;\nconst prepareButtonMappingForExport = (mapping) => {\n  const copy = prepareMappingForExport(mapping);\n  delete copy.deadZone;\n  delete copy.low;\n  return copy;\n};\n\nconst padWithEmptyMappings = (array, length) => {\n  // Keep adding empty mappings until the list is full\n  while (array.length < length) {\n    array.push(emptyMapping());\n  }\n  // In case the input array is longer than the desired length\n  array.length = length;\n  return array;\n};\n\nconst createEmptyMappingList = (length) => padWithEmptyMappings([], length);\n\nconst getMovementConfiguration = (usedKeys) => ({\n  usesArrows:\n    usedKeys.has(\"ArrowUp\") || usedKeys.has(\"ArrowDown\") || usedKeys.has(\"ArrowRight\") || usedKeys.has(\"ArrowLeft\"),\n  usesWASD: (usedKeys.has(\"w\") && usedKeys.has(\"s\")) || (usedKeys.has(\"a\") && usedKeys.has(\"d\")),\n});\n\nconst getGamepadId = (gamepad) => `${gamepad.id} (${gamepad.index})`;\n\nclass GamepadData {\n  /**\n   * @param {Gamepad} gamepad Source Gamepad\n   * @param {GamepadLib} gamepadLib Parent GamepadLib\n   */\n  constructor(gamepad, gamepadLib) {\n    this.gamepad = gamepad;\n    this.gamepadLib = gamepadLib;\n    this.resetMappings();\n  }\n\n  resetMappings() {\n    this.hints = this.gamepadLib.getHints();\n    this.buttonMappings = this.getDefaultButtonMappings().map(transformAndCopyMapping);\n    this.axesMappings = this.getDefaultAxisMappings().map(transformAndCopyMapping);\n  }\n\n  clearMappings() {\n    this.buttonMappings = createEmptyMappingList(this.gamepad.buttons.length);\n    this.axesMappings = createEmptyMappingList(this.gamepad.axes.length);\n  }\n\n  getDefaultButtonMappings() {\n    let buttons;\n    if (this.hints.importedSettings) {\n      buttons = this.hints.importedSettings.buttons;\n    } else {\n      const usedKeys = this.hints.usedKeys;\n      const alreadyUsedKeys = new Set();\n      const { usesArrows, usesWASD } = getMovementConfiguration(usedKeys);\n      if (usesWASD) {\n        alreadyUsedKeys.add(\"w\");\n        alreadyUsedKeys.add(\"a\");\n        alreadyUsedKeys.add(\"s\");\n        alreadyUsedKeys.add(\"d\");\n      }\n      const possiblePauseKeys = [\n        // Restart keys, pause keys, other potentially dangerous keys\n        \"p\",\n        \"q\",\n        \"r\",\n      ];\n      const possibleActionKeys = [\n        \" \",\n        \"Enter\",\n        \"e\",\n        \"f\",\n        \"z\",\n        \"x\",\n        \"c\",\n        ...Array.from(usedKeys).filter((i) => i.length === 1 && !possiblePauseKeys.includes(i)),\n      ];\n\n      const findKey = (keys) => {\n        for (const key of keys) {\n          if (usedKeys.has(key) && !alreadyUsedKeys.has(key)) {\n            alreadyUsedKeys.add(key);\n            return key;\n          }\n        }\n        return null;\n      };\n      const getPrimaryAction = () => {\n        if (usesArrows && usedKeys.has(\"ArrowUp\")) {\n          return \"ArrowUp\";\n        }\n        if (usesWASD && usedKeys.has(\"w\")) {\n          return \"w\";\n        }\n        return findKey(possibleActionKeys);\n      };\n      const getSecondaryAction = () => findKey(possibleActionKeys);\n      const getPauseKey = () => findKey(possiblePauseKeys);\n      const getUp = () => {\n        if (usesArrows || !usesWASD) return \"ArrowUp\";\n        return \"w\";\n      };\n      const getDown = () => {\n        if (usesArrows || !usesWASD) return \"ArrowDown\";\n        return \"s\";\n      };\n      const getRight = () => {\n        if (usesArrows || !usesWASD) return \"ArrowRight\";\n        return \"d\";\n      };\n      const getLeft = () => {\n        if (usesArrows || !usesWASD) return \"ArrowLeft\";\n        return \"a\";\n      };\n\n      const action1 = getPrimaryAction();\n      let action2 = getSecondaryAction();\n      let action3 = getSecondaryAction();\n      let action4 = getSecondaryAction();\n      // When only 1 or 2 action keys are detected, bind the other buttons to the same things.\n      if (action1 && !action2 && !action3 && !action4) {\n        action2 = action1;\n        action3 = action1;\n        action4 = action1;\n      }\n      if (action1 && action2 && !action3 && !action4) {\n        action3 = action1;\n        action4 = action2;\n      }\n\n      // Set indices \"manually\" because we don't evaluate them in order.\n      buttons = [];\n      buttons[0] = {\n        /*\n        Xbox: A\n        SNES-like: B\n        */\n        type: \"key\",\n        high: action1,\n      };\n      buttons[1] = {\n        /*\n        Xbox: B\n        SNES-like: A\n        */\n        type: \"key\",\n        high: action2,\n      };\n      buttons[2] = {\n        /*\n        Xbox: X\n        SNES-like: Y\n        */\n        type: \"key\",\n        high: action3,\n      };\n      buttons[3] = {\n        /*\n        Xbox: Y\n        SNES-like: X\n        */\n        type: \"key\",\n        high: action4,\n      };\n      buttons[4] = {\n        /*\n        Xbox: LB\n        SNES-like: Left trigger\n        */\n        type: \"mousedown\",\n      };\n      buttons[5] = {\n        /*\n        Xbox: RB\n        */\n        type: \"mousedown\",\n      };\n      buttons[6] = {\n        /*\n        Xbox: LT\n        */\n        type: \"mousedown\",\n      };\n      buttons[7] = {\n        /*\n        Xbox: RT\n        SNES-like: Right trigger\n        */\n        type: \"mousedown\",\n      };\n      buttons[9] = {\n        /*\n        Xbox: Menu\n        SNES-like: Start\n        */\n        type: \"key\",\n        high: getPauseKey(),\n      };\n      buttons[8] = {\n        /*\n        Xbox: Change view\n        SNES-like: Select\n        */\n        type: \"key\",\n        high: getPauseKey(),\n      };\n      // Xbox: Left analog press\n      buttons[10] = emptyMapping();\n      // Xbox: Right analog press\n      buttons[11] = emptyMapping();\n      buttons[12] = {\n        /*\n        Xbox: D-pad up\n        */\n        type: \"key\",\n        high: getUp(),\n      };\n      buttons[13] = {\n        /*\n        Xbox: D-pad down\n        */\n        type: \"key\",\n        high: getDown(),\n      };\n      buttons[14] = {\n        /*\n        Xbox: D-pad left\n        */\n        type: \"key\",\n        high: getLeft(),\n      };\n      buttons[15] = {\n        /*\n        Xbox: D-pad right\n        */\n        type: \"key\",\n        high: getRight(),\n      };\n    }\n    return padWithEmptyMappings(buttons, this.gamepad.buttons.length);\n  }\n\n  getDefaultAxisMappings() {\n    let axes = [];\n    if (this.hints.importedSettings) {\n      axes = this.hints.importedSettings.axes;\n    } else {\n      // Only return default axis mappings when there are 4 axes, like an xbox controller\n      // If there isn't exactly 4, we can't really predict what the axes mean\n      // Some controllers map the dpad to *both* buttons and axes at the same time, which would cause conflicts.\n      if (this.gamepad.axes.length === 4) {\n        const usedKeys = this.hints.usedKeys;\n        const { usesArrows, usesWASD } = getMovementConfiguration(usedKeys);\n        if (usesWASD) {\n          axes.push(defaultAxesMappings.wasd[0]);\n          axes.push(defaultAxesMappings.wasd[1]);\n        } else if (usesArrows) {\n          axes.push(defaultAxesMappings.arrows[0]);\n          axes.push(defaultAxesMappings.arrows[1]);\n        } else {\n          axes.push(defaultAxesMappings.cursor[0]);\n          axes.push(defaultAxesMappings.cursor[1]);\n        }\n        axes.push(defaultAxesMappings.cursor[0]);\n        axes.push(defaultAxesMappings.cursor[1]);\n      }\n    }\n    return padWithEmptyMappings(axes, this.gamepad.axes.length);\n  }\n}\n\nconst defaultHints = () => ({\n  usedKeys: new Set(),\n  importedSettings: null,\n  generated: false,\n});\n\nclass GamepadLib extends EventTarget {\n  constructor() {\n    super();\n\n    /** @type {Map<string, GamepadData>} */\n    this.gamepads = new Map();\n\n    this.handleConnect = this.handleConnect.bind(this);\n    this.handleDisconnect = this.handleDisconnect.bind(this);\n    this.update = this.update.bind(this);\n\n    this.animationFrame = null;\n    this.currentTime = null;\n    this.deltaTime = 0;\n\n    this.virtualCursor = {\n      x: 0,\n      y: 0,\n      maxX: Infinity,\n      minX: -Infinity,\n      maxY: Infinity,\n      minY: -Infinity,\n      modified: false,\n    };\n\n    this._editor = null;\n\n    this.connectCallbacks = [];\n\n    this.keysPressedThisFrame = new Set();\n    this.oldKeysPressed = new Set();\n\n    this.mouseButtonsPressedThisFrame = new Set();\n    this.oldMouseDown = new Set();\n\n    this.addEventHandlers();\n  }\n\n  addEventHandlers() {\n    window.addEventListener(\"gamepadconnected\", this.handleConnect);\n    window.addEventListener(\"gamepaddisconnected\", this.handleDisconnect);\n  }\n\n  removeEventHandlers() {\n    window.removeEventListener(\"gamepadconnected\", this.handleConnect);\n    window.removeEventListener(\"gamepaddisconnected\", this.handleDisconnect);\n  }\n\n  gamepadConnected() {\n    if (this.gamepads.size > 0) {\n      return Promise.resolve();\n    }\n    return new Promise((resolve) => {\n      this.connectCallbacks.push(resolve);\n    });\n  }\n\n  getHints() {\n    return Object.assign(defaultHints(), this.getUserHints());\n  }\n\n  getUserHints() {\n    // to be overridden by users\n    return {};\n  }\n\n  resetControls() {\n    for (const gamepad of this.gamepads.values()) {\n      gamepad.resetMappings();\n    }\n  }\n\n  clearControls() {\n    for (const gamepad of this.gamepads.values()) {\n      gamepad.clearMappings();\n    }\n  }\n\n  handleConnect(e) {\n    for (const callback of this.connectCallbacks) {\n      callback();\n    }\n    this.connectCallbacks = [];\n    const gamepad = e.gamepad;\n    const id = getGamepadId(gamepad);\n    console.log(\"connected\", gamepad);\n    const gamepadData = new GamepadData(gamepad, this);\n    this.gamepads.set(id, gamepadData);\n    if (this.animationFrame === null) {\n      this.animationFrame = requestAnimationFrame(this.update);\n    }\n    this.dispatchEvent(new CustomEvent(\"gamepadconnected\", { detail: gamepadData }));\n  }\n\n  handleDisconnect(e) {\n    const gamepad = e.gamepad;\n    const id = getGamepadId(gamepad);\n    console.log(\"disconnected\", gamepad);\n    const gamepadData = this.gamepads.get(id);\n    this.gamepads.delete(id);\n    this.dispatchEvent(new CustomEvent(\"gamepaddisconnected\", { detail: gamepadData }));\n    if (this.gamepads.size === 0) {\n      cancelAnimationFrame(this.animationFrame);\n      this.animationFrame = null;\n      this.currentTime = null;\n    }\n  }\n\n  dispatchKey(key, pressed) {\n    if (pressed) {\n      this.dispatchEvent(new CustomEvent(\"keydown\", { detail: key }));\n    } else {\n      this.dispatchEvent(new CustomEvent(\"keyup\", { detail: key }));\n    }\n  }\n\n  dispatchMouse(button, down) {\n    if (down) {\n      this.dispatchEvent(new CustomEvent(\"mousedown\", { detail: button }));\n    } else {\n      this.dispatchEvent(new CustomEvent(\"mouseup\", { detail: button }));\n    }\n  }\n\n  dispatchMouseMove(x, y) {\n    this.dispatchEvent(new CustomEvent(\"mousemove\", { detail: { x, y } }));\n  }\n\n  updateButton(value, mapping) {\n    if (mapping.type === \"key\") {\n      if (value >= mapping.deadZone) {\n        if (mapping.high) {\n          this.keysPressedThisFrame.add(mapping.high);\n        }\n      } else if (value <= -mapping.deadZone) {\n        if (mapping.low) {\n          this.keysPressedThisFrame.add(mapping.low);\n        }\n      }\n    } else if (mapping.type === \"mousedown\") {\n      const isDown = Math.abs(value) >= mapping.deadZone;\n      if (isDown) {\n        this.mouseButtonsPressedThisFrame.add(mapping.button);\n      }\n    } else if (mapping.type === \"virtual_cursor\") {\n      const deadZone = mapping.deadZone;\n      let action;\n      if (value >= deadZone) action = mapping.high;\n      if (value <= -deadZone) action = mapping.low;\n      if (action) {\n        // an axis value just beyond the deadzone should have a multiplier near 0, a high value should have a multiplier of 1\n        const multiplier = (Math.abs(value) - deadZone) / (1 - deadZone);\n        const speed = multiplier * multiplier * mapping.sensitivity * this.deltaTime;\n        if (action === \"+x\") {\n          this.virtualCursor.x += speed;\n        } else if (action === \"-x\") {\n          this.virtualCursor.x -= speed;\n        } else if (action === \"+y\") {\n          this.virtualCursor.y += speed;\n        } else if (action === \"-y\") {\n          this.virtualCursor.y -= speed;\n        }\n        this.virtualCursor.modified = true;\n      }\n    }\n  }\n\n  update(time) {\n    this.oldKeysPressed = this.keysPressedThisFrame;\n    this.oldMouseButtonsPressed = this.mouseButtonsPressedThisFrame;\n    this.keysPressedThisFrame = new Set();\n    this.mouseButtonsPressedThisFrame = new Set();\n\n    if (this.currentTime === null) {\n      this.deltaTime = 0; // doesn't matter what this is, it's just the first frame\n    } else {\n      this.deltaTime = time - this.currentTime;\n    }\n    this.deltaTime = Math.max(Math.min(this.deltaTime, 1000), 0);\n    this.currentTime = time;\n\n    this.animationFrame = requestAnimationFrame(this.update);\n\n    const gamepads = navigator.getGamepads();\n    for (const gamepad of gamepads) {\n      if (gamepad === null) {\n        continue;\n      }\n\n      const id = getGamepadId(gamepad);\n      const data = this.gamepads.get(id);\n\n      for (let i = 0; i < gamepad.buttons.length; i++) {\n        const button = gamepad.buttons[i];\n        const value = button.value;\n        const mapping = data.buttonMappings[i];\n        this.updateButton(value, mapping);\n      }\n\n      for (let i = 0; i < gamepad.axes.length; i++) {\n        const axis = gamepad.axes[i];\n        const mapping = data.axesMappings[i];\n        this.updateButton(axis, mapping);\n      }\n    }\n\n    if (this._editor) {\n      this._editor.update(gamepads);\n    }\n\n    for (const key of this.keysPressedThisFrame) {\n      if (!this.oldKeysPressed.has(key)) {\n        this.dispatchKey(key, true);\n      }\n    }\n    for (const key of this.oldKeysPressed) {\n      if (!this.keysPressedThisFrame.has(key)) {\n        this.dispatchKey(key, false);\n      }\n    }\n\n    for (const button of this.mouseButtonsPressedThisFrame) {\n      if (!this.oldMouseButtonsPressed.has(button)) {\n        this.dispatchMouse(button, true);\n      }\n    }\n    for (const button of this.oldMouseButtonsPressed) {\n      if (!this.mouseButtonsPressedThisFrame.has(button)) {\n        this.dispatchMouse(button, false);\n      }\n    }\n\n    if (this.virtualCursor.modified) {\n      this.virtualCursor.modified = false;\n      if (this.virtualCursor.x > this.virtualCursor.maxX) {\n        this.virtualCursor.x = this.virtualCursor.maxX;\n      }\n      if (this.virtualCursor.x < this.virtualCursor.minX) {\n        this.virtualCursor.x = this.virtualCursor.minX;\n      }\n      if (this.virtualCursor.y > this.virtualCursor.maxY) {\n        this.virtualCursor.y = this.virtualCursor.maxY;\n      }\n      if (this.virtualCursor.y < this.virtualCursor.minY) {\n        this.virtualCursor.y = this.virtualCursor.minY;\n      }\n      this.dispatchMouseMove(this.virtualCursor.x, this.virtualCursor.y);\n    }\n  }\n}\n\nGamepadLib.browserHasBrokenGamepadAPI = () => {\n  // Check that the gamepad API is supported at all\n  if (!navigator.getGamepads) {\n    return true;\n  }\n  // Firefox on Linux has a broken gamepad API implementation that results in strange and sometimes unusable mappings\n  // https://bugzilla.mozilla.org/show_bug.cgi?id=1643358\n  // https://bugzilla.mozilla.org/show_bug.cgi?id=1643835\n  if (navigator.userAgent.includes(\"Firefox\") && navigator.userAgent.includes(\"Linux\")) {\n    return true;\n  }\n  // Firefox on macOS has other bugs that result in strange and unusable mappings\n  // eg. https://bugzilla.mozilla.org/show_bug.cgi?id=1434408\n  if (navigator.userAgent.includes(\"Firefox\") && navigator.userAgent.includes(\"Mac OS\")) {\n    return true;\n  }\n  return false;\n};\n\nGamepadLib.setConsole = (n) => (console = n);\n\nexport default GamepadLib;\n","import gamepadUserscript from './userscript.js';\nimport gamepadUserstyle from '!raw-loader!./style.css'\n\nconst addStylesheet = (css) => {\n  const stylesheet = document.createElement('style');\n  stylesheet.textContent = css;\n  document.head.appendChild(stylesheet);\n};\n\nconst run = ({ scaffolding, options }) => {\n  gamepadUserscript(scaffolding, options.pointerlock);\n  addStylesheet(gamepadUserstyle);\n};\n\nexport default run;\n","/* inserted by pull.js */\nimport _twAsset0 from \"./active.png\";\nimport _twAsset1 from \"./close.svg\";\nimport _twAsset2 from \"./cursor.png\";\nimport _twAsset3 from \"./dot.svg\";\nconst _twGetAsset = (path) => {\n  if (path === \"/active.png\") return _twAsset0;\n  if (path === \"/close.svg\") return _twAsset1;\n  if (path === \"/cursor.png\") return _twAsset2;\n  if (path === \"/dot.svg\") return _twAsset3;\n  throw new Error(`Unknown asset: ${path}`);\n};\n\nimport GamepadLib from \"./gamepadlib.js\";\n\nexport default async function (scaffolding, pointerlock) {\n  const vm = scaffolding.vm;\n\n  // Wait for the project to finish loading. Renderer and scripts will not be fully available until this happens.\n  await new Promise((resolve) => {\n    if (vm.editingTarget) return resolve();\n    vm.runtime.once(\"PROJECT_LOADED\", resolve);\n  });\n\n  const vmStarted = () => vm.runtime._steppingInterval !== null;\n\n  const scratchKeyToKey = (key) => {\n    switch (key) {\n      case \"right arrow\":\n        return \"ArrowRight\";\n      case \"up arrow\":\n        return \"ArrowUp\";\n      case \"left arrow\":\n        return \"ArrowLeft\";\n      case \"down arrow\":\n        return \"ArrowDown\";\n      case \"enter\":\n        return \"Enter\";\n      case \"space\":\n        return \" \";\n    }\n    return key.toLowerCase().charAt(0);\n  };\n  const getKeysUsedByProject = () => {\n    const allBlocks = [vm.runtime.getTargetForStage(), ...vm.runtime.targets]\n      .filter((i) => i.isOriginal)\n      .map((i) => i.blocks);\n    const result = new Set();\n    for (const blocks of allBlocks) {\n      for (const block of Object.values(blocks._blocks)) {\n        if (block.opcode === \"event_whenkeypressed\" || block.opcode === \"event_whenkeyhit\" || block.opcode === \"sensing_keyoptions\") {\n          // For blocks like \"key (my variable) pressed?\", the sensing_keyoptions still exists but has a null parent.\n          if (block.opcode === \"sensing_keyoptions\" && !block.parent) {\n            continue;\n          }\n          const key = block.fields.KEY_OPTION.value;\n          result.add(scratchKeyToKey(key));\n        }\n      }\n    }\n    return result;\n  };\n\n  const GAMEPAD_CONFIG_MAGIC = \" // _gamepad_\";\n  const findOptionsComment = () => {\n    const target = vm.runtime.getTargetForStage();\n    const comments = target.comments;\n    for (const comment of Object.values(comments)) {\n      if (comment.text.includes(GAMEPAD_CONFIG_MAGIC)) {\n        return comment;\n      }\n    }\n    return null;\n  };\n  const parseOptionsComment = () => {\n    const comment = findOptionsComment();\n    if (!comment) {\n      return null;\n    }\n    const lineWithMagic = comment.text.split(\"\\n\").find((i) => i.endsWith(GAMEPAD_CONFIG_MAGIC));\n    if (!lineWithMagic) {\n      console.warn(\"Gamepad comment does not contain valid line\");\n      return null;\n    }\n    const jsonText = lineWithMagic.substr(0, lineWithMagic.length - GAMEPAD_CONFIG_MAGIC.length);\n    let parsed;\n    try {\n      parsed = JSON.parse(jsonText);\n      if (!parsed || typeof parsed !== \"object\" || !Array.isArray(parsed.buttons) || !Array.isArray(parsed.axes)) {\n        throw new Error(\"Invalid data\");\n      }\n    } catch (e) {\n      console.warn(\"Gamepad comment has invalid JSON\", e);\n      return null;\n    }\n    return parsed;\n  };\n\n  GamepadLib.setConsole(console);\n  const gamepad = new GamepadLib();\n\n  const parsedOptions = parseOptionsComment();\n  gamepad.getUserHints = () => {\n    if (parsedOptions) {\n      return {\n        importedSettings: parsedOptions,\n      };\n    }\n    return {\n      usedKeys: getKeysUsedByProject(),\n    };\n  };\n\n  const renderer = vm.runtime.renderer;\n  const width = renderer._xRight - renderer._xLeft;\n  const height = renderer._yTop - renderer._yBottom;\n  const canvas = renderer.canvas;\n\n  const virtualCursorElement = document.createElement(\"img\");\n  virtualCursorElement.hidden = true;\n  virtualCursorElement.className = \"sa-gamepad-cursor\";\n  virtualCursorElement.src = _twGetAsset(\"/cursor.png\");\n\n  let hideCursorTimeout;\n\n  const hideRealCursor = () => {\n    document.body.classList.add(\"sa-gamepad-hide-cursor\");\n  };\n  const showRealCursor = () => {\n    document.body.classList.remove(\"sa-gamepad-hide-cursor\");\n  };\n  const virtualCursorSetVisible = (visible) => {\n    virtualCursorElement.hidden = !visible;\n    clearTimeout(hideCursorTimeout);\n    if (visible) {\n      hideRealCursor();\n      hideCursorTimeout = setTimeout(virtualCursorHide, 8000);\n    }\n  };\n  const virtualCursorHide = () => {\n    virtualCursorSetVisible(false);\n  };\n  const virtualCursorSetDown = (down) => {\n    virtualCursorSetVisible(true);\n    virtualCursorElement.classList.toggle(\"sa-gamepad-cursor-down\", down);\n  };\n  const virtualCursorSetPosition = (x, y) => {\n    virtualCursorSetVisible(true);\n    const CURSOR_SIZE = 6;\n    const stageX = width / 2 + x - CURSOR_SIZE / 2;\n    const stageY = height / 2 - y - CURSOR_SIZE / 2;\n    virtualCursorElement.style.transform = `translate(${stageX}px, ${stageY}px)`;\n  };\n\n  document.addEventListener(\"mousemove\", () => {\n    virtualCursorSetVisible(false);\n    showRealCursor();\n  });\n\n  let getCanvasSize;\n  // Support modern ResizeObserver and slow getBoundingClientRect version for improved browser support (matters for TurboWarp)\n  if (window.ResizeObserver) {\n    let canvasWidth = width;\n    let canvasHeight = height;\n    const resizeObserver = new ResizeObserver((entries) => {\n      for (const entry of entries) {\n        canvasWidth = entry.contentRect.width;\n        canvasHeight = entry.contentRect.height;\n      }\n    });\n    resizeObserver.observe(canvas);\n    getCanvasSize = () => [canvasWidth, canvasHeight];\n  } else {\n    getCanvasSize = () => {\n      const rect = canvas.getBoundingClientRect();\n      return [rect.width, rect.height];\n    };\n  }\n\n  // Both in Scratch space\n  let virtualX = 0;\n  let virtualY = 0;\n  const postMouseData = (data) => {\n    if (!vmStarted()) return;\n    const [rectWidth, rectHeight] = getCanvasSize();\n    vm.postIOData(\"mouse\", {\n      ...data,\n      canvasWidth: rectWidth,\n      canvasHeight: rectHeight,\n      x: (virtualX + width / 2) * (rectWidth / width),\n      y: (height / 2 - virtualY) * (rectHeight / height),\n    });\n  };\n  const postKeyboardData = (key, isDown) => {\n    if (!vmStarted()) return;\n    vm.postIOData(\"keyboard\", {\n      key,\n      isDown,\n    });\n  };\n  const handleGamepadButtonDown = (e) => postKeyboardData(e.detail, true);\n  const handleGamepadButtonUp = (e) => postKeyboardData(e.detail, false);\n  const handleGamepadMouseDown = (e) => {\n    virtualCursorSetDown(true);\n    postMouseData({\n      isDown: true,\n      button: e.detail,\n    });\n  };\n  const handleGamepadMouseUp = (e) => {\n    virtualCursorSetDown(false);\n    postMouseData({\n      isDown: false,\n      button: e.detail,\n    });\n  };\n  const handleGamepadMouseMove = (e) => {\n    const {x, y} = e.detail;\n    if (pointerlock) {\n      const deltaX = x - virtualX;\n      const deltaY = -(y - virtualY);\n      virtualX = x;\n      virtualY = y;\n      // Coordinates that pointerlock accepts are in \"screen space\" but virtual cursor is in \"stage space\"\n      const SPEED_MULTIPLIER = 4.0;\n      const zoomMultiplierX = scaffolding.layersRect.width / vm.runtime.stageWidth;\n      const zoomMultiplierY = scaffolding.layersRect.height / vm.runtime.stageHeight;\n      // This is defined in pointerlock addon\n      vm.pointerLockMove(\n        deltaX * SPEED_MULTIPLIER * zoomMultiplierX,\n        deltaY * SPEED_MULTIPLIER * zoomMultiplierY\n      );\n    } else {\n      virtualX = x;\n      virtualY = y;\n      virtualCursorSetPosition(virtualX, virtualY);\n      postMouseData({});\n    }\n  };\n\n  if (!pointerlock) {\n    gamepad.virtualCursor.maxX = renderer._xRight;\n    gamepad.virtualCursor.minX = renderer._xLeft;\n    gamepad.virtualCursor.maxY = renderer._yTop;\n    gamepad.virtualCursor.minY = renderer._yBottom;\n  }\n\n  gamepad.addEventListener(\"keydown\", handleGamepadButtonDown);\n  gamepad.addEventListener(\"keyup\", handleGamepadButtonUp);\n  gamepad.addEventListener(\"mousedown\", handleGamepadMouseDown);\n  gamepad.addEventListener(\"mouseup\", handleGamepadMouseUp);\n  gamepad.addEventListener(\"mousemove\", handleGamepadMouseMove);\n\n  if (!pointerlock) {\n    scaffolding._overlays.appendChild(virtualCursorElement);\n  }\n}\n","import gamepad from './gamepad';\nimport pointerlock from './pointerlock';\nimport specialCloudBehaviors from './special-cloud-behaviors';\nimport unsafeCloudBehaviors from './unsafe-cloud-behaviors';\nimport pause from './pause';\n\nconst run = (scaffolding, options) => {\n  const api = {\n    scaffolding,\n    options\n  };\n\n  if (options.gamepad) gamepad(api);\n  if (options.pointerlock) pointerlock(api);\n  if (options.specialCloudBehaviors) specialCloudBehaviors(api);\n  if (options.unsafeCloudBehaviors) unsafeCloudBehaviors(api);\n  if (options.pause) pause(api);\n};\n\nwindow.ScaffoldingAddons = {\n  run\n};\n","export default function ({ scaffolding }) {\n  // This file is based on the `pause` addon from Scratch Addons\n  // All major portions of this file were written by me, so the GPL does not apply\n\n  const STATUS_PROMISE_WAIT = 1;\n  const STATUS_DONE = 4;\n\n  const vm = scaffolding.vm;\n\n  let paused = false;\n  let pausedThreadState = new WeakMap();\n\n  let audioContextStateChange = Promise.resolve();\n\n  const setPaused = (_paused) => {\n    paused = _paused;\n\n    if (paused) {\n      audioContextStateChange = audioContextStateChange.then(() => {\n        return vm.runtime.audioEngine.audioContext.suspend();\n      });\n      if (!vm.runtime.ioDevices.clock._paused) {\n        vm.runtime.ioDevices.clock.pause();\n      }\n\n      for (const thread of vm.runtime.threads) {\n        if (!thread.updateMonitor && !pausedThreadState.has(thread)) {\n          const pauseState = {\n            pauseTime: vm.runtime.currentMSecs,\n            status: thread.status,\n          };\n          pausedThreadState.set(thread, pauseState);\n          thread.status = STATUS_PROMISE_WAIT;\n        }\n      }\n\n      // Immediately emit project stop\n      // Scratch will do this automatically, but there may be a slight delay.\n      vm.runtime.emit(\"PROJECT_RUN_STOP\");\n    } else {\n      audioContextStateChange = audioContextStateChange.then(() => {\n        return vm.runtime.audioEngine.audioContext.resume();\n      });\n      vm.runtime.ioDevices.clock.resume();\n\n      const now = Date.now();\n      for (const thread of vm.runtime.threads) {\n        const pauseState = pausedThreadState.get(thread);\n        if (pauseState) {\n          const stackFrame = thread.peekStackFrame();\n          if (stackFrame && stackFrame.executionContext && stackFrame.executionContext.timer) {\n            const dt = now - pauseState.pauseTime;\n            stackFrame.executionContext.timer.startTime += dt;\n          }\n          // Compiler state is stored differently\n          if (thread.timer) {\n            const dt = now - pauseState.pauseTime;\n            thread.timer.startTime += dt;\n          }\n          thread.status = pauseState.status;\n        }\n      }\n      pausedThreadState = new WeakMap();\n    }\n\n    vm.emit('P4_PAUSE', paused);\n  };\n\n  const ensurePausedThreadIsStillPaused = (thread) => {\n    if (thread.status === STATUS_DONE) {\n      return;\n    }\n    const pauseState = pausedThreadState.get(thread);\n    if (pauseState) {\n      if (thread.status !== STATUS_PROMISE_WAIT) {\n        // We'll record the change so we can properly resume the thread, but the thread must still be paused for now.\n        pauseState.status = thread.status;\n        thread.status = STATUS_PROMISE_WAIT;\n      }\n    }\n  };\n\n  const originalStepThreads = vm.runtime.sequencer.stepThreads;\n  vm.runtime.sequencer.stepThreads = function () {\n    if (paused) {\n      for (const thread of this.runtime.threads) {\n        ensurePausedThreadIsStillPaused(thread);\n      }\n    }\n    return originalStepThreads.call(this);\n  };\n\n  const originalGreenFlag = vm.runtime.greenFlag;\n  vm.runtime.greenFlag = function () {\n    setPaused(false);\n    return originalGreenFlag.call(this);\n  };\n\n  // Disable edge-activated hats and hats like \"when key pressed\" while paused.\n  const originalStartHats = vm.runtime.startHats;\n  vm.runtime.startHats = function (...args) {\n    if (paused) {\n      return [];\n    }\n    return originalStartHats.apply(this, args);\n  };\n\n  // Paused threads should not be counted as running when updating GUI state.\n  const originalGetMonitorThreadCount = vm.runtime._getMonitorThreadCount;\n  vm.runtime._getMonitorThreadCount = function (threads) {\n    let count = originalGetMonitorThreadCount.call(this, threads);\n    if (paused) {\n      for (const thread of threads) {\n        if (pausedThreadState.has(thread)) {\n          count++;\n        }\n      }\n    }\n    return count;\n  };\n\n  vm.setPaused = setPaused;\n  vm.isPaused = () => paused;\n}","const run = ({ scaffolding }) => {\n  const canvas = scaffolding._canvas;\n  const vm = scaffolding.vm;\n  const mouse = vm.runtime.ioDevices.mouse;\n  let isLocked = false;\n\n  const postMouseData = (e, isDown) => {\n    const {movementX, movementY} = e;\n    const {width, height} = scaffolding.layersRect;\n    const x = mouse._clientX + movementX;\n    const y = mouse._clientY - movementY;\n    mouse._clientX = x;\n    mouse._scratchX = mouse.runtime.stageWidth * ((x / width) - 0.5);\n    mouse._clientY = y;\n    mouse._scratchY = mouse.runtime.stageWidth * ((y / height) - 0.5);\n    if (typeof isDown === 'boolean') {\n      const data = {\n        button: e.button,\n        isDown\n      };\n      vm.postIOData('mouse', data);\n    }\n  };\n  document.addEventListener(\"mousedown\", (e) => {\n    if (canvas.contains(e.target)) {\n      e.stopPropagation();\n      if (isLocked) {\n        postMouseData(e, true);\n      } else {\n        canvas.requestPointerLock();\n      }\n    }\n  }, true);\n  document.addEventListener(\"mouseup\", (e) => {\n    e.stopPropagation();\n    if (isLocked) {\n      postMouseData(e, false);\n    } else if (canvas.contains(e.target)) {\n      canvas.requestPointerLock();\n    }\n  }, true);\n  document.addEventListener(\"mousemove\", (e) => {\n    e.stopPropagation();\n    if (isLocked) {\n      postMouseData(e);\n    }\n  }, true);\n\n  scaffolding.addEventListener('PROJECT_RUN_START', () => {\n    if (!isLocked) {\n      canvas.requestPointerLock();\n    }\n  });\n\n  document.addEventListener('pointerlockchange', () => {\n    isLocked = document.pointerLockElement === canvas;\n  });\n  document.addEventListener('pointerlockerror', (e) => {\n    console.error('Pointer lock error', e);\n  });\n\n  vm.pointerLockMove = (deltaX, deltaY) => {\n    postMouseData({\n      // Essentially constructing a fake MouseEvent\n      movementX: deltaX,\n      movementY: deltaY\n    });\n  };\n\n  const oldStep = vm.runtime._step;\n  vm.runtime._step = function (...args) {\n    const ret = oldStep.call(this, ...args);\n    const {width, height} = scaffolding.layersRect;\n    mouse._clientX = width / 2;\n    mouse._clientY = height / 2;\n    mouse._scratchX = 0;\n    mouse._scratchY = 0;\n    return ret;\n  };\n};\n\nexport default run;\n","const SAFE_PROTOCOLS = [\n  // The only protocol that's critical to block is javascript:\n  // file: is indeed unsafe in places like Electron, but it's the Electron environment's job to protect against that\n  // Navigating between file: is safe on the web\n  'http:',\n  'https:',\n  'data:',\n  'file:',\n  'mailto:',\n];\n\nconst isSafeURL = (url) => {\n  try {\n    const u = new URL(url, location.href);\n    return SAFE_PROTOCOLS.includes(u.protocol);\n  } catch (e) {\n    return false;\n  }\n};\n\nconst shouldAlwaysOpenInNewTab = (url) => {\n  try {\n    const u = new URL(url, location.href);\n    // Browsers don't allow opening new tabs with data: URIs\n    return u.protocol === 'data:';\n  } catch (e) {\n    return false;\n  }\n};\n\nconst shouldAlwaysOpenInCurrentTab = (url) => {\n  try {\n    const u = new URL(url, location.href);\n    // If you open a mailto: in a new tab, the browser will convert it to about:blank and just leave an empty tab\n    return u.protocol === 'mailto:';\n  } catch (e) {\n    return false;\n  }\n};\n\nconst openInNewTab = (url) => {\n  window.open(url);\n};\n\nconst openInCurrentTab = (url) => {\n  location.href = url;\n};\n\nclass SpecialCloudBehaviorsProvider {\n  enable () {\n    this.manager.setVariable(this, '☁ url', location.href);\n\n    document.addEventListener('paste', (e) => {\n      const text = (e.clipboardData || window.clipboardData).getData('text');\n      this.manager.setVariable(this, '☁ pasted', text);\n    });\n\n    this.webSocketProvider = this.manager.providers.find(i => typeof i.setProjectId === 'function');\n    this.initialProjectId = this.webSocketProvider ? this.webSocketProvider.projectId : null;\n  }\n\n  handleUpdateVariable (name, value) {\n    if (name === '☁ redirect') {\n      if (isSafeURL(value)) {\n        if (shouldAlwaysOpenInNewTab(value)) {\n          openInNewTab(value);\n        } else {\n          openInCurrentTab(value);\n        }\n      }\n    } else if (name === '☁ open link') {\n      if (isSafeURL(value)) {\n        if (shouldAlwaysOpenInCurrentTab(value)) {\n          openInCurrentTab(value);\n        } else {\n          openInNewTab(value);\n        }\n      }\n    } else if (name === '☁ username') {\n      this.manager.parent.setUsername(value);\n    } else if (name === '☁ set clipboard') {\n      navigator.clipboard.writeText(value);\n    } else if (name === '☁ room id') {\n      if (this.webSocketProvider) {\n        const newId = this.initialProjectId + (value ? `-${value}` : '');\n        this.webSocketProvider.setProjectId(newId);\n      }\n    }\n  }\n}\n\nexport default function ({ scaffolding }) {\n  const provider = new SpecialCloudBehaviorsProvider();\n  scaffolding.addCloudProvider(provider);\n  scaffolding.addCloudProviderOverride('☁ url', provider);\n  scaffolding.addCloudProviderOverride('☁ redirect', provider);\n  scaffolding.addCloudProviderOverride('☁ open link', provider);\n  scaffolding.addCloudProviderOverride('☁ username', provider);\n  scaffolding.addCloudProviderOverride('☁ set clipboard', provider);\n  scaffolding.addCloudProviderOverride('☁ pasted', provider);\n  scaffolding.addCloudProviderOverride('☁ room id', provider);\n}\n","const isPromise = (v) => !!v && typeof v.then === 'function';\n\nconst jsValueToScratchValue = (v) => {\n  if (typeof v === 'boolean' || typeof v === 'number' || typeof v === 'string') {\n    return v;\n  }\n  return '' + v;\n};\n\nclass UnsafeCloudBehaviorsProvider {\n  enable () {\n\n  }\n\n  setEvalValue (value) {\n    this.manager.setVariable(this, '☁ eval output', jsValueToScratchValue(value));\n  }\n\n  setEvalError (error) {\n    console.error('Error evaluating ☁ eval', error);\n    this.manager.setVariable(this, '☁ eval error', jsValueToScratchValue(error));\n  }\n\n  evaluateAsync (js) {\n    try {\n      const value = eval(js);\n      if (isPromise(value)) {\n        value\n          .then((v) => this.setEvalValue(v))\n          .catch((e) => this.setEvalError(e));\n      } else {\n        this.setEvalValue(value)\n      }\n    } catch (e) {\n      this.setEvalError(e);\n    }\n  }\n\n  handleUpdateVariable (name, value) {\n    if (name === '☁ eval') {\n      this.evaluateAsync(value);\n    }\n  }\n}\n\nexport default function ({ scaffolding }) {\n  const provider = new UnsafeCloudBehaviorsProvider();\n  scaffolding.addCloudProvider(provider);\n  scaffolding.addCloudProviderOverride('☁ eval', provider);\n  scaffolding.addCloudProviderOverride('☁ eval output', provider);\n  scaffolding.addCloudProviderOverride('☁ eval error', provider);\n}\n","// Browser support for EventTarget constructor is surprisingly poor, so we always polyfill it\n// We also need to polyfill CustomEvent for Node.js\n\nclass EventTargetShim {\n  constructor () {\n    this._events = {};\n  }\n\n  addEventListener (event, handler) {\n    if (!this._events[event]) {\n      this._events[event] = [];\n    }\n    this._events[event].push(handler);\n  }\n\n  removeEventListener (event, handler) {\n    const handlers = this._events[event];\n    if (handlers) {\n      this._events[event] = handlers.filter(i => i !== handler);\n    }\n  }\n\n  dispatchEvent (event) {\n    const handlers = this._events[event.type];\n    if (handlers) {\n      for (const fn of handlers) {\n        fn(event);\n      }\n    }\n  }\n}\n\nclass CustomEventShim {\n  constructor (type, options) {\n    this.type = type;\n    this.detail = options ? options.detail : {};\n  }\n}\n\nexport {\n  EventTargetShim as EventTarget,\n  CustomEventShim as CustomEvent\n};\n"],"sourceRoot":""}